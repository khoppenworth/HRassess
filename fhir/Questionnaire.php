<!-- Placeholder for Questionnaire.php -->
<?php // fhir/Questionnaire.php require_once __DIR__ . '/utils.php'; require_fhir_auth(); // optionally only staff / admin if (!isset($_GET['questionnaire_id'])) { // return error $resp = [ "resourceType" => "OperationOutcome", "issue" => [ [ "severity" => "error", "code" => "invalid", "details" => [ "text" => "Missing questionnaire_id parameter" ] ] ] ]; send_json($resp, 400); } $questionnaire_id = (int)$_GET['questionnaire_id']; $def = get_questionnaire_definition($questionnaire_id); if (!$def) { $resp = [ "resourceType" => "OperationOutcome", "issue" => [ [ "severity" => "error", "code" => "not-found", "details" => [ "text" => "Questionnaire not found" ] ] ] ]; send_json($resp, 404); } // Build FHIR Questionnaire resource $q = $def['questionnaire']; $items = $def['items']; $fhir = [ "resourceType" => "Questionnaire", "id" => $q['fhir_id'] ?: strval($q['id']), "title" => $q['title'], "status" => "active", "date" => gmdate('Y-m-d\TH:i:s\Z', strtotime($q['created_at'])), "item" => [] ]; foreach ($items as $itm) { $item = [ "linkId" => $itm['link_id'] ?: strval($itm['id']), "text" => $itm['text'], "type" => $itm['type'] // must map to FHIR item types, e.g. "string", "choice" ]; if ($itm['required']) { $item["required"] = true; } if ($itm['type'] === 'choice' && !empty($itm['options'])) { // assume options is JSON array or comma separated $opts = json_decode($itm['options'], true); if (!is_array($opts)) { $opts = explode(',', $itm['options']); } $item["answerOption"] = []; foreach ($opts as $opt) { $item["answerOption"][] = ["valueString" => trim($opt)]; } } $fhir['item'][] = $item; } send_json($fhir); 